---
title: Services Configuration
layout: page
weight: 96
tags:
  - jet
  - configuration
  - services
categories:
  - jet
---

By default, services are expected to be in one of the following 5 files:

* `jet-services.yml`
* `jet-services.json`
* `codeship-services.yml`
* `codeship-services.json`
* `docker-compose.yml`

_Jet_ will look for a services file in this order. The file name can be overridden with the `--services-path` flag. Both YAML and JSON formats are accepted.

The definition of docker services is exactly the same as docker-compose's [docker-compose.yml definition](https://docs.docker.com/compose/yml/), with a few omissions and optional changes:

## Unavailable features

The following directives were just added to docker-compose very recently, and are expected to be implemented but have not been implemented yet:

* `extends`
* `labels`

## Linking to the host

All linking to the host is not allowed. This means the following directives are excluded:

* `external_links`
* `ports`
* `stdin_open`

In addition the behavior of `volumes` has been changed to only allow _CONTAINER_ specifications and ignore any _HOST:CONTAINER_ specifications present.

## Builds

The `build` directive is extended. You can still specify a build in the same way as in docker-compose, just using the directory. However, you can also use our own format:

```yml
build:
  image: codeship/foo
  dockerfile_path: Dockerfile.foo
  configure:
    service: codeship/buildfoo
    command: make compile
```

Let's walk through this:

* `image` specifies the output image name, as opposed to generating one by default.
* `dockerfile_path` allows you to specify a file name as opposed to a directory name. This is useful for having multiple _Dockerfile_'s in the same directory.
* `configure` is optional if using this format. This does the following:
  * Bring up the named service, which must be also described in the services file.
  * Link your working directory into this service and make this the working directory within the service.
  * Run the specified command.

`configure` is useful if steps must be done prior to running `docker build`. For example, when developing _Jet_, we run it inside a Docker container. _Jet_ is written using go, and go allows you to produce a small compiled binary (in this case about 7MB). We need this binary to be available before we can run `docker build`. Otherwise, we would have to have a container that had Go available and compile within it, which results in a 500+MB container. The above example is exactly how we do this.

You must use one of the two formats, either docker-compose's format, or our format. You can intermix these formats within a given file.

## Environment Variables

The standard `environment` and `env_file` directives are supported. Additionally, we support encrypted environment variables
with `encrypted_environment` and `encrypted_env_file` directives. These are the same format, except they expect encrypted variables.
See the description of the [encryption commands]({{ site.baseurl }}{% post_url jet/2015-05-25-commands %}#encryption-commands) for more information and how to use this.

## `add_docker`

The boolean directive `add_docker` is available. If specified for a service, this will:

* Add the environment variables `DOCKER_HOST`, `DOCKER_TLS_VERIFY` and `DOCKER_CERT_PATH` from the host.
* If `DOCKER_CERT_PATH` is set, will mount the certificate directory through to the container.

See https://github.com/codeship/codeship-tool-examples/tree/master/14.add_docker for an example using [Docker-in-Docker](https://registry.hub.docker.com/u/jpetazzo/dind).

## Other Notes

* `link` containers will be newly created for each step.
* `volumes_from` containers will be created exactly once for all services.
