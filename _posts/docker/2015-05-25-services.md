---
title: Services Configuration
layout: page
weight: 56
tags:
  - docker
  - jet
  - configuration
  - services
categories:
  - docker
---

* include a table of contents
{:toc}

## What Is Your Codeship Services File?
Your services files - `codeship-services.yml` - is the [Docker Compose](https://docs.docker.com/compose/) based file your CI/CD process with Codeship relies on to build and orchestrate your environment. At the start of every new build, we create a new instance to run your build on. From there, what containers are build and when is defined by your [codeship-steps.yml]({{ site.baseurl }}/docker/steps/) file running commands on the individual container services defined in your `codeship-services.yml` file.

Your `codeship-services.yml` file, just like Docker Compose, can build images out of Dockerfiles or fetch images from image registries. These image registries can be public or you can provide account credentials to pull (and push) images to private accounts as part of your CI/CD process.

Some great examples of how and why we based `codeship-services.yml` on Docker Compose:

* Set up different environments for running your unit, integration or acceptance tests to keep containers small and startup times fast.

* Build specialized deployment containers to unify deployment across your company

* Use any Docker container available on an image registry for your builds

* Easily switch between different versions of databases or build your own container for a special database

* Have full control over every piece of Software in the build

**Note**: There are a few Docker Compose features not yet supported by `codeship-services.yml`. We will eventually be at full Docker Compose parity, but until then you can use most features of Docker Compose in your `codeship-services.yml` file with little to no modification. For a list of non-supporter Docker Compose features, see below in this article.

## Services File Setup & Configuration
By default we look for the filename `codeship-services.yml` but a `docker-compose.yml` file that does not include any non-support functionality will also be automatically recognized and used if no `codeship-services.yml` is present.

Your services file is structured identically to a standard Docker Compose](https://docs.docker.com/compose/) file with the exception of the unavailable features listed in this article.

### Build Directive
The standard `build` directive is available and further extended. You can still [specify a build](https://docs.docker.com/compose/compose-file/#build) in the same way as standard with Docker Compose, but you can also use an extended version as needed.

You can mix formats in the services file, but not for a single service.

```yaml
app:
  build:
    image: codeship/app
    path: app
    dockerfile_path: Dockerfile
data:
  image: busybox
```

* `image` specifies the output image name, as opposed to generating one by default.

* `path` allows you specify a `custom_directory` to use as the context for building the Docker container. _Note_, that the _Dockerfile_ is searched for relative to that directory. If you don't specify this option, it will default to the directory of the services file.

* `dockerfile_path` allows you to specify a file name as opposed to a directory name. This is useful for having multiple _Dockerfile_'s in the same directory.

### Volumes
You can use `volumes` in your `codeship-services.yml` file to persist data between containers as well as between steps in your CI/CD process.

An example setup using volumes in your `codeship-services.yml` file would look like this:

```
```yaml
app:
  build:
    image: codeship/app
    path: app
    dockerfile_path: Dockerfile
  volumes_from:
    - data
data:
  image: busybox
  volumes:
    - ./tmp/data:/data
```

[Learn more about using volumes.]({{ site.baseurl }}/docker/docker-volumes/)

### Environment Variables
The standard `environment` and `env_file` directives are supported. Additionally, we support encrypted environment variables with `encrypted_environment` and `encrypted_env_file` directives. These are the same format, except they expect encrypted variables.

An example setup explicitly declaring your environment variables in your `codeship-services.yml` file would look like this:

```
app:
  build:
    image: codeship/app
    path: app
    dockerfile_path: Dockerfile
  environment:
    ENV: string
    ENV2: string
```

An example setup explicitly providing your encrypted environment variables in your `codeship-services.yml` file would look like this:

```
app:
  build:
    image: codeship/app
    path: app
    dockerfile_path: Dockerfile
  encrypted_env_file: env.encrypted
```

[Learn more about encrypting your environment variables.]({{ site.baseurl }}/docker/encryption/)

### Docker Inside Docker
The boolean directive `add_docker` is available. If specified for a service, it will:

* Add the environment variables `DOCKER_HOST`, `DOCKER_TLS_VERIFY` and `DOCKER_CERT_PATH` from the host.

* If `DOCKER_CERT_PATH` is set, it will mount the certificate directory through to the container.

See [add_docker](https://github.com/codeship/codeship-tool-examples/tree/master/14.add_docker) for an example using [Docker-in-Docker](https://registry.hub.docker.com/u/jpetazzo/dind).

### Caching the Docker image
We provide a `cached` directive that creates a specially-tagged image push to your image registry that we will attempt to re-use on future builds, rather than rebuilding your Docker image, to save time and speed up your CI/CD process.

An example setup using caching in your `codeship-services.yml` file would look like this:

```yml
app:
  build:
    image: codeship/app
    dockerfile_path: Dockerfile
  cached: true
```

There are several specific requirements and considerations when using caching, so it is recommended that you [read our caching documentation.](https://github.com/codeship/codeship-tool-examples/tree/master/17.caching) before enabling caching on your builds.

### Unavailable Features
The following features available from Docker Compose are not available on Codeship.

* Support for the new `docker-compose.yml` file format introduced with 1.6.0

* Support for network configuration (introduced with the new config format)

* Support for build arguments (introduced with the new config format)

* Support for the following directives

  * `depends_on`
  * `cpu_quota`
  * `stop_signal`
  * `extends`
  * `labels`

All linking to the host is not allowed. This means the following directives are excluded:

  * `external_links`
  * `ports`
  * `stdin_open`

### Docker Compose V2
Codeship does not yet support Docker Compose V2 or V2-specific features such as build arguments. We are currently working on support for Compose features up to the latest version and will announce as soon as full support is available to all users.  

## Other Notes

* `link` containers will be newly created for each step.
* `volumes_from` containers will be created exactly once for all services.
