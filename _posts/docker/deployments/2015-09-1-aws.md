---
title: Continuous Delivery to AWS with Docker
tags:
  - deployment
  - aws
  - docker
categories:
  - docker
---

To make it easy for you to deploy your application to AWS we've built a container that has the AWSCLI installed. We will set up a simple example showing you how to configure any deployment to AWS.

The container configuration is open source and can be found in the [codeship-library/aws-deployment](https://github.com/codeship-library/aws-deployment) project on Github. It includes a working example that uses the AWSCLI as part of an integration test before we push a new container to the Docker Hub.

## Dockerfile

Create an additional `Dockerfile` in your repository that is used to deploy your application. You can name it something like `Dockerfile.deploy`. The `codeship/aws-deployment` container will automatically copy the content of your repository into the new container as we've set [ONBUILD](https://docs.docker.com/reference/builder/#onbuild) instructions.

```Dockerfile
FROM codeship/aws-deployment:latest
```

## Authentication

Before setting up the `codeship-services.yml` and `codeship-steps.yml` file we're going to create an encrypted environment file that contains the `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`.

Take a look at our [encrypted environment files documentation]({{ site.baseurl }}{% post_url docker/tutorials/2015-09-15-encryption %}) and add a `aws-deployment.env.encrypted` file to your repository. The file needs to contain an encrypted version of the following file:

```bash
AWS_ACCESS_KEY_ID=your_access_key_id
AWS_SECRET_ACCESS_KEY=your_secret_access_key
```

You can get the `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` from the IAM settings in your [AWS Console](https://console.aws.amazon.com/console/home). You can read more about this in the [IAM documentation](http://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html). Do not use the admin keys provided to your main AWS account and make sure to limit the access to what is necessary for your deployment through IAM.

## Service Definition

In the `codeship-services.yml` we're starting a Docker build with the aforementioned `Dockerfile.deploy`. We can then use the newly created container to deploy our application through the `codeship-steps.yml`.

```yaml
awsdeployment:
  build:
    image: codeship/aws-deployment
    dockerfile_path: Dockerfile.deploy
  encrypted_env_file: aws-deployment.env.encrypted
```

## Deploy Steps

Simply use the `aws` commands the AWSCLI provides. In the following example we're uploading a file to S3.

```yaml
- service: awsdeployment
  command: aws s3 cp SOME_FILE s3://SOME_BUCKET
```

You can use any AWS service or command provided by the [AWSCLI](https://aws.amazon.com/cli/). You can use environment variables or command arguments to set the AWS Region or other parameters. Take a look at their (environment variable documentation](http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html#cli-environment).
