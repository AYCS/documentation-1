--
title: Push
layout: page
weight: 55
tags:
  - docker
  - jet
  - configuration
  - push
categories:
  - docker
---

Push steps allow a generated container to be pushed to a remote docker registry. When running after a build, this allows a deployment based upon the successful build to occur. You must specify a number of directives:

*  `type`: this must be set to push.
*  `service`: the service to run the command on. If the run step is a sub-step of a parallel step, `service` cannot be specified, otherwise it is required.
*  `name`: the name of this push step.
*  `image_name`: the name of the generated image as it exists in your service.yml/json file, in the format `[registry/][owner/]name[:tag]`.
*  `registry`: the url of the registry being pushed to. For Dockerhub, use `https://index.docker.io/v1/`.
*  `encrypted_dockercfg_path`: the path to your relevant dockercfg file, encrypted using `jet encrypt`.
*  `tag`: a group tag associated with this build step (optional).

When using a private repository, or a non-standard tag, keep in mind your step directives _MUST_ match your service descriptions. In order to use a private registry, the `image_name` directive in your steps file needs to match the `image_name` from `codeship_services.yml`, and should look something like `myregistry.mydomain.com:5002/myuser/myrepo`.

Before an image can be pushed, it must be built, so ensure your relevant image is represented in a previous step in your build pipeline, even if it is just a simple command being run inside the container. This will ensure the image is available to be pushed.

## Push to remote docker registry example

```shell
docker run -d --cidfile ./registry.cid -p 5000:5000 registry
```


```shell
`codeship-services.yml`
```

```shell
demo:
  build:
    image: localhost:5000/myapp
    dockerfile_path: Dockerfile
registry:
  image: registry
  ports:
    - "5000:5000"
```

`codeship-steps.yml` push to local host:

```shell
- service: app
  command: ls ./
- service: app
  type: push
  name: docker_push
  image_name: localhost:5000/myapp
  registry: localhost:5000
```

Then run the following script:

```shell
#!/bin/bash

if [ -e registry.cid ]; then
  CID=`cat registry.cid`
  docker stop $CID
  docker rm $CID
  rm registry.cid
fi
```

## Push to Quay example

**Prerequisites:** You will need to have a robot account for your Quay repository. Please see Quay.io [Robot Accounts](http://docs.quay.io/glossary/robot-accounts.html) doc to set one up for your repository.

* Log in to Quay via docker:

```shell
    docker login -e="." -u="<username>+<>" -p="<token>" quay.io
```

* Configure your `codeship-services.yml` file. Example:

```shell
app:
  build:
    image: bovice/discourse
    dockerfile_path: Dockerfile
```

* Configure your `codeship-steps.yml` file. Make sure your `image_name` is identical to the one one on your `codeship-services.yml`. Point `registry` to your image repositoryâ€™s url

```shell
- service: app
  type: push
  image_name: bovice/discourse
  registry: quay.io/username/reponame
```

As always, feel free to contact support@codeship.com if you have any questions.
